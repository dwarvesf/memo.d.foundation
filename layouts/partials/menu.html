{{ $currentPage := .Sites.First.Home }}

<nav class="menu">
  {{ $menus := .Site.Menus }}
  {{ $data := slice }}
  {{ $menuNames := slice "earn" "hiring" "memo" "radar" }}
  {{ range $menuNames }}
    {{ $menuName := . }}
    {{ $posts := index $menus $menuName }}
    {{ if $posts }}
      {{ range $posts }}
        {{ $data = $data | append (dict "url" .URL "name" .Name "menu" $menuName) }}
      {{ end }}
    {{ end }}
  {{ end }}

  <section
    class="site-nav"
    x-data="{
      currentUrl: `{{ .RelPermalink }}`,
      start: 0,
      end: 12,
      loaded: false,
      loadText: 'Load More...',
      get value() {
        const dataString = `{{ $data | jsonify }}`;
        const data = JSON.parse(dataString);
        const mappedData = data.reduce((acc, value) => {
          if (!acc[value.menu]) acc[value.menu] = [];
          acc[value.menu].push(value);
          return acc;
        }, {});
        return mappedData;
      },
      isSameGroupUrl(menu) {
        return this.currentUrl.includes(menu);
      },
      partialValue(items, start, end) {
        return items.slice(start, end);
      },
      toggleLoad(isLoaded) {
        if (!isLoaded) {
          this.end = -1;
          this.loaded = true;
          this.loadText = 'Load Less...'
        } else {
          this.end = 12;
          this.loaded = false;
          this.loadText = 'Load More...'
        }
      },
    }"
  >
    <template x-for="menu in Object.keys(value)" x-bind:key="menu">
      <template x-if="isSameGroupUrl(menu)">
        <details open>
          <summary>Posts</summary>
          <ul>
            <template x-for="items in partialValue(value[menu], start, end)">
              <li>
                <a x-bind:href="items.url" x-text="items.name"></a>
              </li>
            </template>
            <template x-if="value[menu].length > end">
              <li class="load-more" @click="toggleLoad(loaded)" x-text="loadText"></li>
            </template>
          </ul>
        </details>
      </template>
    </template>
  </section>
</nav>
