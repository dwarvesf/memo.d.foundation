# Fix: README.md Redirects Missing from Nginx Configuration

## Problem

README.md redirects generated by `generate-redirects-map.ts` were not appearing in the nginx redirect map configuration file (`nginx_redirect_map.conf`). These redirects are important for handling direct requests to README.md files and redirecting them to their parent directory URLs.

For example:

- `/research/topics/pm/readme.md` should redirect to `/research/topics/pm`
- `/playbook/design/readme.md` should redirect to `/playbook/design`

## Root Cause

The issue was in the `filterRedirectsLogic` function in `scripts/common.ts`. This function filters out redirects that match alias patterns to avoid conflicts. However, it was too aggressive and filtered out legitimate README.md redirects when their target paths matched alias patterns.

The problematic logic checked if:

1. The redirect target matched any alias key/value
2. The redirect source matched any alias pattern

README.md redirects like `/research/topics/pm/readme.md` â†’ `/research/topics/pm` were being filtered out because `/research/topics/pm` might match alias entries in the reversed alias mapping.

## Solution

Modified the `filterRedirectsLogic` function in `scripts/common.ts` to include a special case for README.md redirects:

1. Added detection for README.md redirects using `normalizedRedirectKey.toLowerCase().endsWith('/readme.md')`
2. Modified the alias matching logic to skip filtering for README.md redirects
3. Ensured README.md redirects are always processed, regardless of alias conflicts

## Code Changes

```typescript
// Special case: Always include README.md redirects, regardless of alias conflicts
const isReadmeRedirect = normalizedRedirectKey
  .toLowerCase()
  .endsWith('/readme.md');

const isMatchedAlias =
  !isReadmeRedirect &&
  aliasesEntries.some(([aliasKey, aliasVal]) => {
    // ... existing alias matching logic
  });

if (!isMatchedAlias || isReadmeRedirect) {
  processRedirect(/* ... */);
}
```

## Result

- All README.md redirects are now properly included in the nginx configuration
- Over 70+ README.md redirects are now working correctly
- No conflicts with existing alias system
- README.md files can be accessed directly and will redirect to their parent directory URLs

## Testing

Verified the fix by:

1. Running `pnpm run generate-nginx-conf`
2. Confirming README.md redirects appear in `nginx_redirect_map.conf`
3. Cross-referencing with entries in `redirects.json`
